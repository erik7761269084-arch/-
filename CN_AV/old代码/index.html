<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å›½äº§AV ç”µå½±ã€å¥³ä¼˜ä¸å‡ºå“å‚ç›®å½•</title>
<style>
/* ï¼ˆä½ åŸæ¥çš„ CSS å®Œæ•´ä¿ç•™ â€” ä¸ºèŠ‚çœç¯‡å¹…è¿™é‡Œç…§æ¬ä½ ä¹‹å‰çš„æ ·å¼ï¼‰ */
body {
  margin: 0;
  font-family: "å¾®è½¯é›…é»‘", sans-serif;
  background-color: #0d0d0d;
  color: #fff;
  display: flex;
  height: 100vh;
  overflow: hidden;
}

/* å·¦ä¾§å¯¼èˆªæ  */
.sidebar {
  width: 220px;
  background-color: #111;
  border-right: 1px solid #222;
  padding-top: 20px;
  display: flex;
  flex-direction: column;
  position: fixed;
  left: 0;
  top: 0;
  bottom: 0;
  transition: transform 0.3s ease;
  z-index: 1000;
}
.sidebar.hidden {
  transform: translateX(-100%);
}
.sidebar h2 {
  text-align: center;
  margin-bottom: 20px;
  font-size: 18px;
}
.sidebar button {
  background: none;
  color: #ccc;
  border: none;
  text-align: left;
  padding: 12px 20px;
  font-size: 15px;
  cursor: pointer;
}
.sidebar button:hover, .sidebar button.active {
  background-color: #222;
  color: #fff;
}

/* é¡¶éƒ¨èœå•æŒ‰é’®ï¼ˆä»…ç§»åŠ¨ç«¯æ˜¾ç¤ºï¼‰ */
.menu-toggle {
  display: none;
  position: fixed;
  top: 12px;
  left: 12px;
  background-color: #222;
  color: #fff;
  border: none;
  padding: 10px 14px;
  font-size: 20px;
  border-radius: 6px;
  cursor: pointer;
  z-index: 1100;
}
.menu-toggle:hover {
  background-color: #333;
}

/* ä¸»å†…å®¹åŒºåŸŸ */
.main {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
  margin-left: 220px;
  transition: margin-left 0.3s ease;
}

/* å½“ä¾§è¾¹æ éšè—æ—¶ï¼Œä¸»å†…å®¹å…¨å®½ */
.sidebar.hidden + .main {
  margin-left: 0;
}

/* å“åº”å¼é€‚é…ï¼šæ‰‹æœºç«¯è‡ªåŠ¨éšè—ä¾§è¾¹æ  */
@media (max-width: 768px) {
  .sidebar {
    transform: translateX(-100%);
  }
  .sidebar.show {
    transform: translateX(0);
  }
  .main {
    margin-left: 0;
    padding-top: 60px;
  }
  .menu-toggle {
    display: block;
  }
}

/* ======= å¡ç‰‡é€šç”¨æ ·å¼ ======= */
.grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 20px; }
.card { position: relative; background-color: #1a1a1a; border-radius: 8px; overflow: hidden; cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease; display: flex; flex-direction: column; }
.card:hover { transform: scale(1.05); box-shadow: 0 4px 12px rgba(255,255,255,0.2); }
.card img { width: 100%; aspect-ratio: 16/9; object-fit: cover; }
.card-type { position: absolute; bottom: 8px; right: 8px; font-size: 12px; font-weight: bold; color: #fff; border: 1px solid #ff0000; padding: 2px 6px; border-radius: 4px; background-color: #ff0000; }
.actor { position: absolute; bottom: 8px; left: 8px; background-color: rgba(0,0,0,0.5); padding: 2px 6px; border-radius: 4px; font-size: 12px; }
.card-info { padding: 8px 10px; display: flex; flex-direction: column; gap: 6px; }
.card-info-top { display: flex; align-items: center; gap: 6px; overflow: hidden; }
.card-info-top .idcode { color: #ffcc00; font-weight: bold; font-size: 12px; white-space: nowrap; flex-shrink: 0; }
.card-info-top .title { font-size: 14px; color: #fff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex-grow: 1; }
.card-info-bottom { display: flex; justify-content: space-between; align-items: center; font-size: 12px; color: #ccc; }
.star { color: gold; font-weight: bold; }
.date { display: flex; align-items: center; gap: 4px; }
.date::before { content: "ğŸ“…"; font-size: 13px; }

/* å¥³ä¼˜ç›®å½• */
#actressGrid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px; }
#actressGrid .card img { width: 100%; height: 260px; object-fit: cover; background-color: #222; }
#actressGrid .card-title { padding: 10px; font-size: 15px; text-align: center; color: #eee; }
#actressGrid .card-info { font-size: 13px; color: #ccc; text-align: center; padding-bottom: 10px; line-height: 1.6; }

/* æ‰‹æœºç«¯å¥³ä¼˜å¡ç‰‡ç¼©æ”¾ä¼˜åŒ– */
@media (max-width: 768px) {
  #actressGrid {
    grid-template-columns: repeat(2, 1fr) !important; /* ä¸€è¡Œä¸¤ä¸ª */
    gap: 12px !important; /* ç¼©å°é—´è· */
  }
  #actressGrid .card img {
    height: 200px !important; /* å›¾ç‰‡æ›´å° */
  }
  #actressGrid .card-title {
    font-size: 13px !important; /* åå­—å­—ä½“ç¼©å° */
  }
  #actressGrid .card-info {
    font-size: 12px !important; /* èµ„æ–™å­—ä½“ç¼©å° */
  }
}


/* å‡ºå“å‚ */
#companyGrid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 25px; justify-items: center; }
.company-card { background-color: #1a1a1a; border-radius: 10px; overflow: hidden; cursor: pointer; transition: transform 0.25s ease, box-shadow 0.25s ease, opacity 0.3s; text-align: center; aspect-ratio: 16/9; width: 100%; max-width: 400px; position: relative; }
.company-card:hover { transform: scale(1.05); box-shadow: 0 4px 12px rgba(255,255,255,0.2); }
.company-card img { width: 100%; height: 100%; object-fit: cover; opacity: 0.5; transition: opacity 0.3s; }
.company-card:hover img { opacity: 0.3; }
.company-card .card-overlay { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; }
.company-card .card-title { color: #fff; font-size: 20px; font-weight: bold; text-shadow: 0 0 8px rgba(0,0,0,0.8); letter-spacing: 1px; margin-bottom: 4px; }
.company-card .card-info { font-size: 12px; color: #ccc; opacity: 0.9; }

/* åˆ†é¡µ */
.pagination { margin-top: 20px; display: flex; align-items: center; gap: 6px; flex-wrap: wrap; justify-content: center; }
.pagination button { padding: 6px 12px; background: #333; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
.pagination button.active { background: red; }
.pagination input { width: 50px; padding: 4px; border-radius: 4px; border: 1px solid #555; background: #222; color: #fff; text-align: center; }
.pagination span { font-size: 14px; }

.fade-out { opacity: 0; transition: opacity 0.3s ease-out; }
</style>
</head>
<body>

<!-- æ‰‹æœºç«¯èœå•æŒ‰é’® -->
<button class="menu-toggle" onclick="toggleSidebar()">â˜°</button>

<div class="sidebar" id="sidebar">
  <h2>å¾¡å¥³å®«å›½äº§AV</h2>
  <button class="active" onclick="filterCategory('å…¨éƒ¨', event)">å…¨éƒ¨</button>
  <button onclick="showActressDirectory(event)">å¥³ä¼˜ç›®å½•</button>
  <button onclick="showCompanyDirectory(event)">AVå‡ºå“å‚</button>
</div>

<div class="main" id="mainContent">
  <div id="dramaSection">
    <div class="grid" id="dramaGrid"></div>
    <div class="pagination" id="pagination"></div>
  </div>

  <div id="actressSection" style="display:none;">
    <div id="actressGrid"></div>
    <div class="pagination" id="actressPagination"></div>
  </div>

  <div id="companySection" style="display:none;">
    <div id="companyGrid"></div>
    <div class="pagination" id="companyPagination"></div>
  </div>
</div>

<script>
/* ======= æ‰‹æœºç«¯èœå•æ”¶ç¼©é€»è¾‘ ======= */
function toggleSidebar() {
  const sidebar = document.getElementById("sidebar");
  sidebar.classList.toggle("show");
}

/* ======= é€šç”¨ç¼“å­˜å·¥å…· ======= */
function saveState(prefix, page, scroll) {
  try {
    localStorage.setItem(`${prefix}_page`, String(page));
    localStorage.setItem(`${prefix}_scroll`, String(scroll));
  } catch (e) { /* ignore storage errors */ }
}
function restoreState(prefix) {
  const page = parseInt(localStorage.getItem(`${prefix}_page`) || "1", 10);
  const scroll = parseInt(localStorage.getItem(`${prefix}_scroll`) || "0", 10);
  return { page: isNaN(page)?1:page, scroll: isNaN(scroll)?0:scroll };
}
function saveActiveSection(name) {
  try { localStorage.setItem("active_section", name); } catch(e){}
}
function getActiveSection() {
  return localStorage.getItem("active_section") || "drama";
}

/* ======= ç”µå½±æ•°æ®é€»è¾‘ (drama) ======= */
let dramas = [], filtered = [], currentPage = 1, pageSize = 24;
async function loadDramas() {
  const res = await fetch("https://raw.githubusercontent.com/erik7761269084-arch/-/main/CN_AV/category/drama_export.json");
  dramas = await res.json();
  filtered = dramas;

  // æ¢å¤active sectionï¼Œå¦‚æœä¸æ˜¯ drama å°±å…ˆä¸è¦æ˜¾ç¤º drama
  const active = getActiveSection();
  if (active !== "drama") {
    document.getElementById("dramaSection").style.display = "none";
  } else {
    document.getElementById("dramaSection").style.display = "block";
  }

  const { page, scroll } = restoreState("drama");
  currentPage = page;
  renderPage(currentPage);

  // åªåœ¨ active ä¸º drama æ—¶æ¢å¤æ»šåŠ¨
  if (active === "drama" && scroll) {
    setTimeout(() => window.scrollTo(0, scroll), 200);
  }
}
function renderPage(page) {
  const container = document.getElementById('dramaGrid');
  container.innerHTML = '';
  const start = (page-1)*pageSize;
  const end = start+pageSize;
  filtered.slice(start,end).forEach(d=>{
    const card=document.createElement('div'); card.className='card';
    card.onclick=()=>{
      // ä¿å­˜å½“å‰æ ç›®ä¸çŠ¶æ€ï¼Œè¿›å…¥æ’­æ”¾é¡µ
      saveActiveSection("drama");
      saveState("drama", currentPage, window.scrollY);
      // è·³è½¬åˆ°æ’­æ”¾é¡µé¢
      window.location.href = d.title_play_url;
    };
    const rating=parseFloat(d.rating)||0; let stars='';
    const fullStars=Math.floor(rating); const halfStar=rating%1>=0.5?1:0;
    for(let i=0;i<fullStars;i++) stars+='â˜…'; if(halfStar) stars+='â˜†';
    for(let i=stars.length;i<5;i++) stars+='âœ©';
    card.innerHTML=`<div style="position: relative;"><img src="${d.cover_url}" alt="${d.title}"><div class="actor">${d.actress}</div><div class="card-type">${d.type}</div></div><div class="card-info"><div class="card-info-top"><span class="idcode">${d.IDcode}</span><span class="title">${d.title}</span></div><div class="card-info-bottom"><div class="star">${stars} ${d.rating}</div><div class="date">${d.publish_date}</div></div></div>`;
    container.appendChild(card);
  });
  renderPagination();
}
function renderPagination(){
  const pagination=document.getElementById('pagination'); pagination.innerHTML='';
  const totalPages=Math.max(1, Math.ceil(filtered.length/pageSize));
  const prevBtn=document.createElement('button'); prevBtn.textContent='ä¸Šä¸€é¡µ'; prevBtn.disabled=currentPage===1;
  prevBtn.onclick=()=>{ if(currentPage>1){currentPage--; renderPage(currentPage); saveState("drama", currentPage, window.scrollY); saveActiveSection("drama");} };
  pagination.appendChild(prevBtn);
  const pageInfo=document.createElement('span'); pageInfo.innerHTML=`ç¬¬ <input type="number" min="1" max="${totalPages}" value="${currentPage}" id="jumpPage"> é¡µ / å…± ${totalPages} é¡µ`; pagination.appendChild(pageInfo);
  const jumpBtn=document.createElement('button'); jumpBtn.textContent='è·³è½¬';
  jumpBtn.onclick=()=>{ const val=parseInt(document.getElementById('jumpPage').value); if(val>=1 && val<=totalPages){currentPage=val; renderPage(currentPage); saveState("drama", currentPage, window.scrollY); saveActiveSection("drama");} };
  pagination.appendChild(jumpBtn);
  const nextBtn=document.createElement('button'); nextBtn.textContent='ä¸‹ä¸€é¡µ'; nextBtn.disabled=currentPage===totalPages;
  nextBtn.onclick=()=>{ if(currentPage<totalPages){currentPage++; renderPage(currentPage); saveState("drama", currentPage, window.scrollY); saveActiveSection("drama");} }; pagination.appendChild(nextBtn);
}

/* ======= å¥³ä¼˜ç›®å½•é€»è¾‘ (actress) ======= */
let actresses=[],actressPage=1,actressPageSize=16;
async function loadActresses(){
  const res=await fetch("https://raw.githubusercontent.com/erik7761269084-arch/-/main/CN_AV/category/CN_actress_menu_all.json");
  const data=await res.json();
  actresses=data.filter(a=>a.img_url && a.img_url.trim()!=="");

  // å¦‚æœ active section ä¸æ˜¯ actressï¼Œå…ˆéšè— actressSection
  const active = getActiveSection();
  if (active !== "actress") {
    document.getElementById("actressSection").style.display = "none";
  }

  const { page, scroll } = restoreState("actress");
  actressPage = page || 1;
  renderActresses();

  if (active === "actress" && scroll) {
    setTimeout(() => window.scrollTo(0, scroll), 200);
  }
}
function renderActresses(){
  const container=document.getElementById('actressGrid'); container.innerHTML='';
  const start=(actressPage-1)*actressPageSize; const end=start+actressPageSize;
  actresses.slice(start,end).forEach(a=>{
    const card=document.createElement('div'); card.className='card';
    card.onclick=()=>{
      saveActiveSection("actress");
      saveState("actress", actressPage, window.scrollY);
      if(a.actress_url) window.location.href=a.actress_url;
    };
    card.innerHTML=`<img src="${a.img_url}" alt="${a.name}"><div class="card-title">${a.name}</div><div class="card-info">${a.zodiac?`ğŸŒŸ ${a.zodiac}<br>`:""}${a.height?`ğŸ“ ${a.height}<br>`:""}${a.measurements?`ğŸ’ƒ ${a.measurements}`:""}</div>`;
    container.appendChild(card);
  });
  renderActressPagination();
}
function renderActressPagination(){
  const pagination=document.getElementById('actressPagination'); pagination.innerHTML='';
  const totalPages=Math.max(1, Math.ceil(actresses.length/actressPageSize));
  const prev=document.createElement('button'); prev.textContent='ä¸Šä¸€é¡µ'; prev.disabled=actressPage===1; prev.onclick=()=>{ if(actressPage>1){actressPage--; renderActresses(); saveState("actress", actressPage, window.scrollY); saveActiveSection("actress");} }; pagination.appendChild(prev);
  const span=document.createElement('span'); span.textContent=`ç¬¬ ${actressPage} / ${totalPages} é¡µ`; pagination.appendChild(span);
  const next=document.createElement('button'); next.textContent='ä¸‹ä¸€é¡µ'; next.disabled=actressPage===totalPages; next.onclick=()=>{ if(actressPage<totalPages){actressPage++; renderActresses(); saveState("actress", actressPage, window.scrollY); saveActiveSection("actress");} }; pagination.appendChild(next);
}

/* ======= å‡ºå“å‚é€»è¾‘ (company) ======= */
let companies=[],companyPage=1,companyPageSize=24;
async function loadCompanies(){
  const res=await fetch("https://raw.githubusercontent.com/erik7761269084-arch/-/main/CN_AV/category/company_all.json");
  const data=await res.json();
  companies=data.filter(c=>c.company && c.company.trim()!=="");

  // active section æ§åˆ¶æ˜¾ç¤º
  const active = getActiveSection();
  if (active !== "company") {
    document.getElementById("companySection").style.display = "none";
  }

  const { page, scroll } = restoreState("company");
  companyPage = page || 1;
  renderCompanies();
  if (active === "company" && scroll) {
    setTimeout(() => window.scrollTo(0, scroll), 200);
  }
}
function renderCompanies(){
  const container=document.getElementById('companyGrid'); container.innerHTML='';
  const start=(companyPage-1)*companyPageSize; const end=start+companyPageSize;
  companies.slice(start,end).forEach(c=>{
    const card=document.createElement('div'); card.className='company-card';
    card.onclick=()=>{
      saveActiveSection("company");
      saveState("company", companyPage, window.scrollY);
      if(c.company_url) window.location.href=c.company_url;
    };
    card.innerHTML=`<img src="https://picture.yoshiclub.xyz/20230930/20230930013717874874.jpg" alt="${c.company}"><div class="card-overlay"><div class="card-title">${c.company}</div><div class="card-info">ğŸ“€ ${c.works_count||0} éƒ¨ä½œå“</div></div>`;
    container.appendChild(card);
  });
  renderCompanyPagination();
}
function renderCompanyPagination(){
  const pagination=document.getElementById('companyPagination'); pagination.innerHTML='';
  const totalPages=Math.max(1, Math.ceil(companies.length/companyPageSize));
  const prev=document.createElement('button'); prev.textContent='ä¸Šä¸€é¡µ'; prev.disabled=companyPage===1; prev.onclick=()=>{ if(companyPage>1){companyPage--; renderCompanies(); saveState("company", companyPage, window.scrollY); saveActiveSection("company");} }; pagination.appendChild(prev);
  const span=document.createElement('span'); span.textContent=`ç¬¬ ${companyPage} / ${totalPages} é¡µ`; pagination.appendChild(span);
  const next=document.createElement('button'); next.textContent='ä¸‹ä¸€é¡µ'; next.disabled=companyPage===totalPages; next.onclick=()=>{ if(companyPage<totalPages){companyPage++; renderCompanies(); saveState("company", companyPage, window.scrollY); saveActiveSection("company");} }; pagination.appendChild(next);
}

/* ======= åˆ‡æ¢æ ç›®å’Œä¾§è¾¹æŒ‰é’®è¡Œä¸ºï¼ˆåŒæ—¶ä¿å­˜ active_sectionï¼‰ ======= */
function filterCategory(cat, event){
  // æŠŠåŸæ¥çš„ active èŠ‚ç‚¹å–æ¶ˆ
  document.querySelectorAll('.sidebar button').forEach(b=>b.classList.remove('active'));
  event.target.classList.add('active');

  // æ˜¾ç¤º drama å¹¶ä¿å­˜ active
  document.getElementById("actressSection").style.display="none"; 
  document.getElementById("companySection").style.display="none"; 
  document.getElementById("dramaSection").style.display="block";
  saveActiveSection("drama");
  // æ¢å¤ drama çŠ¶æ€
  const { page, scroll } = restoreState("drama");
  currentPage = page || 1;
  renderPage(currentPage);
  setTimeout(() => window.scrollTo(0, scroll), 150);
}

function showActressDirectory(event){
  document.querySelectorAll('.sidebar button').forEach(b=>b.classList.remove('active')); event.target.classList.add('active');
  document.getElementById("dramaSection").style.display="none"; 
  document.getElementById("companySection").style.display="none"; 
  document.getElementById("actressSection").style.display="block";
  saveActiveSection("actress");
  // æ¢å¤ actress çŠ¶æ€
  const { page, scroll } = restoreState("actress");
  actressPage = page || 1;
  renderActresses();
  setTimeout(() => window.scrollTo(0, scroll), 150);
}

function showCompanyDirectory(event){
  document.querySelectorAll('.sidebar button').forEach(b=>b.classList.remove('active')); event.target.classList.add('active');
  document.getElementById("dramaSection").style.display="none"; 
  document.getElementById("actressSection").style.display="none"; 
  document.getElementById("companySection").style.display="block";
  saveActiveSection("company");
  // æ¢å¤ company çŠ¶æ€
  const { page, scroll } = restoreState("company");
  companyPage = page || 1;
  renderCompanies();
  setTimeout(() => window.scrollTo(0, scroll), 150);
}

/* ======= å…¨å±€æ»šåŠ¨ç›‘å¬ï¼šæ ¹æ®å½“å‰æ˜¾ç¤ºæ ç›®ä¿å­˜å¯¹åº” scroll ======= */
window.addEventListener("scroll", () => {
  // ä¼˜åŒ–ï¼šåªä¿å­˜å¯è§æ ç›®
  if (document.getElementById("dramaSection").style.display !== "none") {
    saveState("drama", currentPage, window.scrollY);
  } else if (document.getElementById("actressSection").style.display !== "none") {
    saveState("actress", actressPage, window.scrollY);
  } else if (document.getElementById("companySection").style.display !== "none") {
    saveState("company", companyPage, window.scrollY);
  }
});

/* ======= å¯åŠ¨åŠ è½½ï¼šæ ¹æ® active_section æ¢å¤å¯¹åº”æ ç›® ======= */
async function boot() {
  const active = getActiveSection();
  // å…ˆé»˜è®¤éšè—å…¨éƒ¨ï¼Œç„¶ååŠ è½½å„è‡ªæ•°æ® (åŠ è½½å‡½æ•°ä¼šæ ¹æ® active å†³å®šæ˜¯å¦æ¢å¤æ»šåŠ¨)
  document.getElementById("dramaSection").style.display = "none";
  document.getElementById("actressSection").style.display = "none";
  document.getElementById("companySection").style.display = "none";

  // å¹¶è¡ŒåŠ è½½ä¸‰ä¸ªåˆ—è¡¨æ•°æ®ï¼ˆæ•°æ®å¯ç¼“å­˜ï¼Œä¸å½±å“æ€§èƒ½ï¼‰
  await Promise.all([loadDramas(), loadActresses(), loadCompanies()]);

  // æ ¹æ® active æ˜¾ç¤ºå¯¹åº”æ ç›®å¹¶æ¢å¤ç„¦ç‚¹æ ·å¼ï¼ˆä¾§è¾¹æŒ‰é’®ï¼‰
  if (active === "actress") {
    document.querySelectorAll('.sidebar button').forEach(b=>b.classList.remove('active'));
    // æ‰¾åˆ°â€œå¥³ä¼˜ç›®å½•â€æŒ‰é’®å¹¶æ¿€æ´»ï¼ˆæŒ‰é¡ºåºï¼š å…¨éƒ¨ã€å¥³ä¼˜ã€å‡ºå“å‚ï¼‰
    const btns = document.querySelectorAll('.sidebar button');
    if (btns && btns[1]) btns[1].classList.add('active');
    document.getElementById("dramaSection").style.display = "none";
    document.getElementById("actressSection").style.display = "block";
  } else if (active === "company") {
    document.querySelectorAll('.sidebar button').forEach(b=>b.classList.remove('active'));
    const btns = document.querySelectorAll('.sidebar button');
    if (btns && btns[2]) btns[2].classList.add('active');
    document.getElementById("dramaSection").style.display = "none";
    document.getElementById("companySection").style.display = "block";
  } else {
    // é»˜è®¤ drama
    document.querySelectorAll('.sidebar button').forEach(b=>b.classList.remove('active'));
    const btns = document.querySelectorAll('.sidebar button');
    if (btns && btns[0]) btns[0].classList.add('active');
    document.getElementById("dramaSection").style.display = "block";
  }
}

// å¯åŠ¨
boot();
</script>
</body>
</html>
