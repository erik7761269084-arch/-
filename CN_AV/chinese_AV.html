<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å›½äº§AV</title>
<style>
/* ======= å…¨å±€æ ·å¼ ======= */
body {
  margin: 0;
  font-family: "å¾®è½¯é›…é»‘", sans-serif;
  background-color: #0d0d0d;
  color: #fff;
  padding-top: 60px; /* é¢„ç•™é¡¶éƒ¨å¯¼èˆªé«˜åº¦ */
}

/* ======= å½±ç‰‡ç½‘æ ¼ ======= */
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
  gap: 20px;
  padding: 20px;
}

.card {
  position: relative;
  background-color: #1a1a1a;
  border-radius: 8px;
  overflow: hidden;
  cursor: pointer;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  display: flex;
  flex-direction: column;
}
.card:hover {
  transform: scale(1.05);
  box-shadow: 0 4px 12px rgba(255, 255, 255, 0.2);
}
.card img {
  width: 100%;
  aspect-ratio: 16 / 9;
  object-fit: cover;
}

/* ======= å¡ç‰‡ä¿¡æ¯å±‚ ======= */
.card-type {
  position: absolute;
  bottom: 8px;
  right: 8px;
  font-size: 12px;
  font-weight: bold;
  color: #fff;
  border: 1px solid #ff0000;
  padding: 2px 6px;
  border-radius: 4px;
  background-color: #ff0000;
}
.actor {
  position: absolute;
  bottom: 8px;
  left: 8px;
  background-color: rgba(0, 0, 0, 0.5);
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 12px;
}

.card-info {
  padding: 8px 10px;
  display: flex;
  flex-direction: column;
  gap: 6px;
}
.card-info-top {
  display: flex;
  align-items: center;
  gap: 6px;
  overflow: hidden;
}
.card-info-top .idcode {
  color: #ffcc00;
  font-weight: bold;
  font-size: 12px;
  white-space: nowrap;
  flex-shrink: 0;
}
.card-info-top .title {
  font-size: 14px;
  color: #fff;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  flex-grow: 1;
}
.card-info-bottom {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 12px;
  color: #ccc;
}
.star { color: gold; font-weight: bold; }
.date { display: flex; align-items: center; gap: 4px; }
.date::before { content: "ğŸ“…"; font-size: 13px; }

/* ======= åˆ†é¡µ ======= */
.pagination {
  margin-top: 20px;
  display: flex;
  align-items: center;
  gap: 6px;
  flex-wrap: wrap;
  justify-content: center;
  padding-bottom: 30px;
}
.pagination button {
  padding: 6px 12px;
  background: #333;
  color: #fff;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}
.pagination button.active { background: red; }
.pagination button:hover:not(:disabled) { background: #555; }
.pagination button:disabled { opacity: 0.4; cursor: not-allowed; }
.pagination input {
  width: 50px;
  padding: 4px;
  border-radius: 4px;
  border: 1px solid #555;
  background: #222;
  color: #fff;
  text-align: center;
}
.pagination span { font-size: 14px; }
/* å›ºå®š header */
#header-placeholder {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  z-index: 999;
}
</style>
</head>
<body>

<!-- ======= é¡¶éƒ¨å¯¼èˆªæ  ======= -->
<div id="header-placeholder"></div>

<!-- ======= ä¸»ä½“å†…å®¹ ======= -->
<div id="mainContent">
  <div id="dramaSection">
    <div class="grid" id="dramaGrid"></div>
    <div class="pagination" id="pagination"></div>
  </div>
</div>

<script>
/* ======= åŠ è½½ header.html + header.js ======= */
fetch('header.html')
  .then(res => res.text())
  .then(html => {
    document.getElementById('header-placeholder').innerHTML = html;

    // åŠ è½½ header.js æ–‡ä»¶
    const script = document.createElement('script');
    script.src = 'header.js';
    script.onload = () => {
      if (typeof initHeaderMenu === 'function') initHeaderMenu();
      if (typeof setActiveMenu === 'function') setActiveMenu('menu-drama');
    };
    document.body.appendChild(script);
  });


/* ========== åŠ è½½åº•éƒ¨ footer.html ========== */ 
fetch('https://yunvgong.com/footer.html')
  .then(r => r.text())
  .then(html => {
    // åŠ¨æ€åˆ›å»ºåº•éƒ¨å®¹å™¨å¹¶æ’å…¥é¡µé¢
    let footer = document.getElementById('footer-placeholder');
    if (!footer) {
      footer = document.createElement('div');
      footer.id = 'footer-placeholder';
      document.body.appendChild(footer);
    }
    footer.innerHTML = html;
  })
  .catch(e => console.warn('æ— æ³•åŠ è½½ footer.html:', e));


/* ======= åŠ è½½å½±ç‰‡æ•°æ® ======= */
let dramas = [], filtered = [], currentPage = 1, pageSize = 24;

async function loadDramas() {
  try {
    const res = await fetch("https://raw.githubusercontent.com/erik7761269084-arch/-/main/CN_AV/category/drama_export.json");
    dramas = await res.json();
    filtered = dramas;
    renderPage(currentPage);
  } catch (e) {
    console.error("åŠ è½½å½±ç‰‡å¤±è´¥ï¼š", e);
    document.getElementById('dramaGrid').innerHTML =
      "<p style='text-align:center;color:#ccc;'>åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åå†è¯•ã€‚</p>";
  }
}

function renderPage(page) {
  const container = document.getElementById('dramaGrid');
  container.innerHTML = '';
  const start = (page - 1) * pageSize;
  const end = start + pageSize;
  filtered.slice(start, end).forEach(d => {
    const card = document.createElement('div');
    card.className = 'card';
    card.onclick = () => { window.location.href = d.title_play_url; };

    const rating = parseFloat(d.rating) || 0;
    let stars = '';
    const full = Math.floor(rating);
    const half = rating % 1 >= 0.5 ? 1 : 0;
    for (let i = 0; i < full; i++) stars += 'â˜…';
    if (half) stars += 'â˜†';
    for (let i = stars.length; i < 5; i++) stars += 'âœ©';

    card.innerHTML = `
      <div style="position: relative;">
        <img src="${d.cover_url}" alt="${d.title}">
        <div class="actor">${d.actress}</div>
        <div class="card-type">${d.type}</div>
      </div>
      <div class="card-info">
        <div class="card-info-top">
          <span class="idcode">${d.IDcode}</span>
          <span class="title">${d.title}</span>
        </div>
        <div class="card-info-bottom">
          <div class="star">${stars} ${d.rating}</div>
          <div class="date">${d.publish_date}</div>
        </div>
      </div>`;
    container.appendChild(card);
  });
  renderPagination();
}

function renderPagination() {
  const pagination = document.getElementById('pagination');
  pagination.innerHTML = '';
  const totalPages = Math.max(1, Math.ceil(filtered.length / pageSize));

  const prev = document.createElement('button');
  prev.textContent = 'ä¸Šä¸€é¡µ';
  prev.disabled = currentPage === 1;
  prev.onclick = () => {
    if (currentPage > 1) {
      currentPage--;
      renderPage(currentPage);
    }
  };
  pagination.appendChild(prev);

  const pageInfo = document.createElement('span');
  pageInfo.innerHTML = `ç¬¬ <input type="number" min="1" max="${totalPages}" value="${currentPage}" id="jumpPage"> é¡µ / å…± ${totalPages} é¡µ`;
  pagination.appendChild(pageInfo);

  const jumpBtn = document.createElement('button');
  jumpBtn.textContent = 'è·³è½¬';
  jumpBtn.onclick = () => {
    const val = parseInt(document.getElementById('jumpPage').value);
    if (val >= 1 && val <= totalPages) {
      currentPage = val;
      renderPage(currentPage);
    }
  };
  pagination.appendChild(jumpBtn);

  const next = document.createElement('button');
  next.textContent = 'ä¸‹ä¸€é¡µ';
  next.disabled = currentPage === totalPages;
  next.onclick = () => {
    if (currentPage < totalPages) {
      currentPage++;
      renderPage(currentPage);
    }
  };
  pagination.appendChild(next);
}

/* ======= åˆå§‹åŒ– ======= */
loadDramas();
</script>
</body>
</html>
