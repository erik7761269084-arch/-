<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AV公司影片详情</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    color: #fff;
    background-color: #000;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* 背景模糊层 */
  body::before {
    content: "";
    position: fixed;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
    background: var(--bg-url) center center / cover no-repeat;
    filter: brightness(0.3);
    opacity: 0.6;
    z-index: -1;
  }

  .container {
    width: 100%;
    min-height: 100vh;
    padding: 50px 80px;
    background: rgba(0,0,0,0.6);
    box-sizing: border-box;
  }

  header {
    text-align: center;
    font-size: 28px;
    font-weight: bold;
    margin-bottom: 30px;
    color: #ffcc00;
  }

  /* ======= 影片卡片 ======= */
  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px,1fr));
    gap: 20px;
  }

  .card {
    position: relative;
    background-color: #1a1a1a;
    border-radius: 8px;
    overflow: hidden;
    cursor: pointer;
    transition: transform 0.25s ease, box-shadow 0.25s ease;
    display: flex;
    flex-direction: column;
  }

  .card:hover { transform: scale(1.05); box-shadow: 0 4px 12px rgba(255,255,255,0.2); }
  .card img { width: 100%; aspect-ratio: 16/9; object-fit: cover; background-color: #222; }

  .card-type {
    position: absolute; bottom: 8px; right: 8px;
    font-size: 12px; font-weight: bold;
    color: #fff; border: 1px solid #ff0000;
    padding: 2px 6px; border-radius: 4px; background-color: #ff0000;
  }

  .actor {
    position: absolute; bottom: 8px; left: 8px;
    background-color: rgba(0,0,0,0.5);
    padding: 2px 6px; border-radius: 4px; font-size: 12px;
  }

  .card-info {
    padding: 10px;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .card-info-top {
    display: flex;
    align-items: center;
    gap: 6px;
    overflow: hidden;
  }

  .idcode {
    color: #ffcc00;
    font-weight: bold;
    font-size: 12px;
    flex-shrink: 0;
  }

  .title {
    font-size: 14px;
    color: #fff;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    flex-grow: 1;
  }

  .card-info-bottom {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 12px;
    color: #ccc;
  }

  /* ======= 分页 ======= */
  .pagination {
    margin-top: 25px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    flex-wrap: wrap;
  }
  .pagination button {
    padding: 4px 8px;
    background: #333;
    color: #fff;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }
  .pagination button.active { background: red; }
  .pagination input {
    width: 40px;
    padding: 2px;
    border-radius: 4px;
    border: 1px solid #555;
    background: #222;
    color: #fff;
    text-align: center;
  }
</style>
</head>
<body>

<div class="container">
  <header id="companyHeader">加载中...</header>

  <div class="grid" id="dramaGrid"></div>

  <div class="pagination" id="pagination"></div>
</div>

<script>
// === 从 URL 获取公司名称参数 ===
function getCompanyName() {
  const params = new URLSearchParams(window.location.search);
  return params.get('series') || '未知公司';
}

// === 动态加载 JS 数据文件 ===
function loadCompanyData(companyName) {
  const script = document.createElement('script');
  script.src = `CN_company_data/${companyName}_company_data.js`;
  script.onload = () => {
    if (window.companyData) {
      initPage(window.companyData);
    } else {
      alert("companyData 未定义，请检查数据文件。");
    }
  };
  script.onerror = () => alert("公司数据加载失败: " + companyName);
  document.body.appendChild(script);
}

// === 初始化页面 ===
let currentPage = 1;
const pageSize = 12;
let dramas = [];

function initPage(data) {
  document.getElementById("companyHeader").textContent = `${data.company}（共 ${data.works_count} 部作品）`;

  // 设置背景图
  const bg = data.dramas.find(d => d.background_img)?.background_img;
  if (bg) document.body.style.setProperty('--bg-url', `url('${bg}')`);

  dramas = data.dramas || [];
  renderPage(1);
}

// === 渲染分页内容 ===
function renderPage(page) {
  const container = document.getElementById("dramaGrid");
  container.innerHTML = "";
  const start = (page - 1) * pageSize;
  const end = start + pageSize;
  const pageData = dramas.slice(start, end);

  pageData.forEach(d => {
    const card = document.createElement("div");
    card.className = "card";
    card.onclick = () => window.open(d.title_play_url, "_blank");

    card.innerHTML = `
      <div style="position:relative;">
        <img src="${d.cover_url}" alt="${d.title}" onerror="this.src='https://via.placeholder.com/300x180?text=No+Image'">
        <div class="actor">${Array.isArray(d.actress) ? d.actress.join(", ") : d.actress || ""}</div>
        <div class="card-type">${d.type}</div>
      </div>
      <div class="card-info">
        <div class="card-info-top">
          <span class="idcode">${d.IDcode}</span>
          <span class="title">${d.title}</span>
        </div>
        <div class="card-info-bottom">
          <span class="date">${d.publish_date || ""}</span>
        </div>
      </div>
    `;
    container.appendChild(card);
  });

  updatePagination(page);
}

// === 更新分页条 ===
function updatePagination(page) {
  const totalPages = Math.ceil(dramas.length / pageSize);
  const pagination = document.getElementById("pagination");
  pagination.innerHTML = "";

  const prev = document.createElement("button");
  prev.textContent = "上一页";
  prev.disabled = page === 1;
  prev.onclick = () => { if (page > 1) renderPage(page - 1); };
  pagination.appendChild(prev);

  const info = document.createElement("span");
  info.innerHTML = `第 <input type="number" id="jumpPage" value="${page}" min="1" max="${totalPages}"> 页 / 共 ${totalPages} 页`;
  pagination.appendChild(info);

  const jumpBtn = document.createElement("button");
  jumpBtn.textContent = "跳转";
  jumpBtn.onclick = () => {
    const val = parseInt(document.getElementById("jumpPage").value);
    if (val >= 1 && val <= totalPages) renderPage(val);
  };
  pagination.appendChild(jumpBtn);

  const next = document.createElement("button");
  next.textContent = "下一页";
  next.disabled = page === totalPages;
  next.onclick = () => { if (page < totalPages) renderPage(page + 1); };
  pagination.appendChild(next);
}

// === 启动 ===
const companyName = getCompanyName();
loadCompanyData(companyName);
</script>

</body>
</html>
