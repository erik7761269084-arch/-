<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>福利姬播放</title>
<style>
html, body { margin:0; padding:0; height:100%; overflow:hidden; background:#111; font-family:"Microsoft YaHei",sans-serif; }
.container { width:100%; height:100%; display:flex; flex-direction:column; text-align:center; box-sizing:border-box; }
h2 { font-size:22px; margin:10px; padding:5px; color:#fff; overflow:hidden; white-space:nowrap; text-overflow:ellipsis; }
.source a { color:#1e90ff; text-decoration:none; }
#comicContainer { flex:1; display:flex; justify-content:center; align-items:center; overflow:hidden; position:relative; background:#111; cursor:grab; }
img { display:block; max-width:100%; max-height:100%; transform-origin:top left; transition: transform 0.1s; user-select:none; pointer-events:all; }
.nav-btn { position:fixed; top:50%; transform:translateY(-50%); background:rgba(0,0,0,0.5); border:none; color:#fff; font-size:24px; padding:10px 15px; cursor:pointer; border-radius:5px; z-index:999; }
#prevBtn { left:10px; }
#nextBtn { right:10px; }
#pageNumber { position:fixed; bottom:10px; left:50%; transform:translateX(-50%); font-size:16px; color:#fff; background:rgba(0,0,0,0.5); padding:5px 10px; border-radius:10px; z-index:999; }
</style>
</head>
<body>

<div class="container">
  <h2 id="comicTitle"></h2>
  <div class="source">
    原文：<a id="comicSource" href="" target="_blank">Telegraph 原文</a>
  </div>
  <div id="comicContainer"></div>
</div>

<button id="prevBtn" class="nav-btn">&#8593;</button>
<button id="nextBtn" class="nav-btn">&#8595;</button>
<div id="pageNumber">1 / 1</div>

<script>
// ------------------------
// 获取 URL ?series 参数
// ------------------------
function getSeriesFromURL(){
    const params = new URLSearchParams(window.location.search);
    let series = parseInt(params.get('series'));
    if(!series || series < 1) series = 1;
    return series;
}

const seriesID = getSeriesFromURL();

// ------------------------
// 动态加载 JS 文件
// ------------------------
function loadComicData(series){
    return new Promise((resolve, reject)=>{
        const script = document.createElement('script');
        script.src = `https://yunvgong.com/GirlPhoto/menu/${series}_comics_data.js`; // 对应你生成的 JS 文件
        script.onload = () => {
            if(typeof comicData !== 'undefined'){
                resolve(comicData);
            } else {
                reject(`漫画数据 ${series}_comics_data.js 未定义 comicData`);
            }
        };
        script.onerror = ()=>reject(`加载漫画数据 ${series}_comics_data.js 失败`);
        document.body.appendChild(script);
    });
}

// ------------------------
// 渲染漫画
// ------------------------
function renderComic(data){
    const container = document.getElementById("comicContainer");
    document.getElementById("comicTitle").innerText = data.title;
    document.getElementById("comicSource").href = data.sourceUrl;

    data.images.forEach(src=>{
        const img = document.createElement("img");
        img.src = src;
        img.className = "comic-page";
        container.appendChild(img);

        // 初始化缩放参数
        img.scale = 1;
        img.offsetX = 0;
        img.offsetY = 0;

        function updateTransform(){
            img.style.transform = `translate(${img.offsetX}px, ${img.offsetY}px) scale(${img.scale})`;
        }

        // 鼠标滚轮缩放
        img.addEventListener("wheel", e=>{
            e.preventDefault();
            const scaleAmount = e.deltaY < 0 ? 1.1 : 0.9;
            img.scale *= scaleAmount;
            const rect = img.getBoundingClientRect();
            const dx = e.clientX - rect.left;
            const dy = e.clientY - rect.top;
            img.offsetX -= dx*(scaleAmount-1);
            img.offsetY -= dy*(scaleAmount-1);
            updateTransform();
        });

        // 拖动
        let dragging=false, startX=0, startY=0;
        img.addEventListener("mousedown", e=>{
            dragging=true; startX=e.clientX-img.offsetX; startY=e.clientY-img.offsetY;
            container.style.cursor="grabbing";
        });
        document.addEventListener("mousemove", e=>{
            if(dragging){ img.offsetX=e.clientX-startX; img.offsetY=e.clientY-startY; updateTransform(); }
        });
        document.addEventListener("mouseup", ()=>{ dragging=false; container.style.cursor="grab"; });

        // 双击重置
        img.addEventListener("dblclick", ()=>{
            img.scale=1; img.offsetX=0; img.offsetY=0; updateTransform();
        });
    });

    const pages = document.querySelectorAll(".comic-page");
    let currentIndex = 0;
    function showPage(index){
        pages.forEach((img,i)=>{ img.style.display=(i===index)?"block":"none"; img.scale=1; img.offsetX=0; img.offsetY=0; img.style.transform=""; });
        document.getElementById("pageNumber").innerText=`${index+1} / ${pages.length}`;
    }

    showPage(currentIndex);

    // 翻页逻辑
    function prevPage(){ if(currentIndex>0) currentIndex--; showPage(currentIndex); }
    function nextPage(){ if(currentIndex<pages.length-1) currentIndex++; showPage(currentIndex); }

    document.getElementById("prevBtn").addEventListener("click", prevPage);
    document.getElementById("nextBtn").addEventListener("click", nextPage);
    document.addEventListener("keydown", e=>{
        if(["ArrowDown","PageDown","ArrowRight"].includes(e.key)) nextPage();
        if(["ArrowUp","PageUp","ArrowLeft"].includes(e.key)) prevPage();
    });
}

// ------------------------
// 页面启动
// ------------------------
loadComicData(seriesID)
.then(data=>renderComic(data))
.catch(err=>console.error(err));
</script>

</body>
</html>
