<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>视频播放</title>
<link rel="stylesheet" href="player.css">
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.1/dist/hls.min.js"></script>
</head>
<body>
<div class="container">
  <div class="player">
    <video id="video" controls playsinline></video>
    <div id="overlay"></div>
  </div>
  <div class="nav-buttons">
    <button id="prev">上一集</button>
    <button id="next">下一集</button>
  </div>
  <div class="playlist" id="playlist"></div>
  <div class="details">
    <h1 id="title"></h1>
    <p><strong>状态:</strong> <span id="status"></span></p>
    <p><strong>类别:</strong> <span id="category"></span></p>
    <p><strong>导演:</strong> <span id="director"></span></p>
    <p><strong>主演:</strong> <span id="actors"></span></p>
    <p><strong>国家/语言/年代:</strong> <span id="meta"></span></p>
    <p><strong>剧情介绍:</strong></p>
    <p id="description"></p>
  </div>
</div>

<script>
// 获取 ?series=xxx
const params = new URLSearchParams(window.location.search);
const series = params.get('series') || 'heibaiju';

// 动态加载对应的 JS 数据文件
const script = document.createElement('script');
script.src = series + '.js';
document.head.appendChild(script);

script.onload = () => {
  const data = window.seriesData;
  if(!data) return;

  // 填充信息
  document.getElementById('title').textContent = data.title;
  document.getElementById('status').textContent = data.status;
  document.getElementById('category').textContent = data.category;
  document.getElementById('director').textContent = data.director;
  document.getElementById('actors').textContent = data.actors;
  document.getElementById('meta').textContent = data.meta;
  document.getElementById('description').textContent = data.description;

  const video = document.getElementById('video');
  const playlist = document.getElementById('playlist');
  const overlay = document.getElementById('overlay');

  const eps = Object.entries(data.episodes);
  let currentIndex = 0;

  function loadEpisode(index, btn) {
    const url = eps[index][1];
    if(Hls.isSupported()) {
      const hls = new Hls();
      hls.loadSource(url);
      hls.attachMedia(video);
      hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
    } else if(video.canPlayType('application/vnd.apple.mpegurl')) {
      video.src = url;
      video.addEventListener('loadedmetadata', () => video.play());
    }
    playlist.querySelectorAll('button').forEach(b => b.classList.remove('active'));
    if(btn) btn.classList.add('active');
    currentIndex = index;
    overlay.textContent = data.title + ' - ' + eps[index][0];
  }

  // 生成按钮
  eps.forEach(([ep], idx) => {
    const btn = document.createElement('button');
    btn.textContent = ep;
    btn.onclick = () => loadEpisode(idx, btn);
    playlist.appendChild(btn);
  });

  document.getElementById('prev').onclick = () => {
    if(currentIndex>0) loadEpisode(currentIndex-1, playlist.children[currentIndex-1]);
  };
  document.getElementById('next').onclick = () => {
    if(currentIndex<eps.length-1) loadEpisode(currentIndex+1, playlist.children[currentIndex+1]);
  };

  video.addEventListener('pause', () => overlay.style.opacity=1);
  video.addEventListener('play', () => overlay.style.opacity=0);

  loadEpisode(0, playlist.children[0]);
};
</script>
</body>
</html>
