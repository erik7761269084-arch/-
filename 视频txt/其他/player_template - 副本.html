<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title id="page-title">播放器</title>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.1/dist/hls.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #2c2c2c; color: #fff; margin: 0; padding: 0; }
    .container { max-width: 1200px; margin: 20px auto; padding: 0 10px; }
    .player { margin-bottom: 20px; position: relative; }
    video { width: 100%; height: auto; background: black; touch-action: pan-y; }

    /* 暂停浮层 */
    #overlay {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      background: rgba(0,0,0,0.5);
      color: #fff;
      font-size: 22px;
      font-weight: bold;
      z-index: 10;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s ease;
      text-align: center;
      padding: 20px;
    }

    /* 控制按钮放大 (部分浏览器有效) */
    video::-webkit-media-controls-volume-slider,
    video::-webkit-media-controls-mute-button,
    video::-webkit-media-controls-fullscreen-button {
      transform: scale(1.5);
      margin: 0 6px;
    }

    .nav-buttons { display: flex; justify-content: center; gap: 15px; margin: 10px 0; }
    .nav-buttons button { background: #444; color: #fff; border: none; padding: 10px 20px; cursor: pointer; border-radius: 4px; transition: 0.2s; }
    .nav-buttons button:hover { background: #555; }

    .playlist { display: flex; flex-wrap: wrap; gap: 10px; padding: 10px 0; justify-content: center; }
    .playlist button { background: #444; color: #fff; border: none; padding: 10px 15px; cursor: pointer; border-radius: 4px; transition: 0.2s; }
    .playlist button:hover { background: #555; }
    .playlist button.active { background: #1e90ff; }

    .details { background: #1c1c1c; padding: 15px; border-radius: 8px; }
    .details h1 { margin: 0 0 10px 0; font-size: 24px; }
    .details p { margin: 5px 0; line-height: 1.5; }
    .details strong { color: #1e90ff; }
  </style>
</head>
<body>

<div class="container">
  <div class="player">
    <video id="video" controls playsinline webkit-playsinline x5-playsinline></video>
    <div id="overlay"></div>
  </div>

  <div class="nav-buttons">
    <button id="prev">上一集</button>
    <button id="next">下一集</button>
  </div>

  <div class="playlist" id="playlist"></div>

  <div class="details">
    <h1 id="title">加载中...</h1>
    <p><strong>状态:</strong> <span id="status"></span></p>
    <p><strong>类别:</strong> <span id="category"></span></p>
    <p><strong>导演:</strong> <span id="director"></span></p>
    <p><strong>主演:</strong> <span id="actors"></span></p>
    <p><strong>国家/语言/年代:</strong> <span id="meta"></span></p>
    <p><strong>剧情介绍:</strong></p>
    <p id="description"></p>
  </div>
</div>

<script>
const params = new URLSearchParams(window.location.search);
const series = params.get("series") || "heibaiju"; // 默认 heibaiju
const script = document.createElement("script");
script.src = series + "_data.js";
document.body.appendChild(script);

script.onload = () => {
  if (!window.seriesData) {
    alert("剧集数据加载失败！");
    return;
  }

  const { title, status, category, director, actors, meta, description, episodes } = window.seriesData;

  document.getElementById("title").textContent = title;
  document.getElementById("page-title").textContent = title + " - 线上看";
  document.getElementById("status").textContent = status;
  document.getElementById("category").textContent = category;
  document.getElementById("director").textContent = director;
  document.getElementById("actors").textContent = actors;
  document.getElementById("meta").textContent = meta;
  document.getElementById("description").textContent = description;

  const video = document.getElementById("video");
  const playlist = document.getElementById("playlist");
  const overlay = document.getElementById("overlay");
  let currentIndex = 0;

  function loadEpisode(index, btn) {
    const url = Object.values(episodes)[index];
    if (!url) return;

    if(Hls.isSupported()) {
      const hls = new Hls();
      hls.loadSource(url);
      hls.attachMedia(video);
      hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
    } else if (video.canPlayType("application/vnd.apple.mpegurl")) {
      video.src = url;
      video.addEventListener("loadedmetadata", () => video.play());
    }

    document.querySelectorAll("#playlist button").forEach(b => b.classList.remove("active"));
    if (btn) btn.classList.add("active");
    currentIndex = index;
  }

  function updateOverlay() {
    const epName = Object.keys(episodes)[currentIndex];
    overlay.textContent = title + " - " + epName;
  }

  Object.entries(episodes).forEach(([ep, url], index) => {
    const btn = document.createElement("button");
    btn.textContent = ep;
    btn.onclick = () => loadEpisode(index, btn);
    playlist.appendChild(btn);
  });

  document.getElementById("prev").onclick = () => {
    if (currentIndex > 0) {
      const btn = playlist.children[currentIndex - 1];
      loadEpisode(currentIndex - 1, btn);
    }
  };
  document.getElementById("next").onclick = () => {
    if (currentIndex < Object.keys(episodes).length - 1) {
      const btn = playlist.children[currentIndex + 1];
      loadEpisode(currentIndex + 1, btn);
    }
  };

  video.addEventListener("pause", () => {
    updateOverlay();
    overlay.style.opacity = 1;
  });

  video.addEventListener("play", () => {
    overlay.style.opacity = 0;
  });

  const firstBtn = playlist.querySelector("button");
  if (firstBtn) {
    firstBtn.classList.add("active");
    loadEpisode(0, firstBtn);
  }
};
</script>

</body>
</html>
