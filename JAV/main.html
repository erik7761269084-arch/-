<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å›½äº§AV - å½±ç‰‡åˆ—è¡¨</title>
<style>
body {
  margin: 0;
  font-family: "å¾®è½¯é›…é»‘", sans-serif;
  background-color: #0d0d0d;
  color: #fff;
  padding-top: 60px;
}
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
  gap: 20px;
  padding: 20px;
}
.card {
  position: relative;
  background-color: #1a1a1a;
  border-radius: 8px;
  overflow: hidden;
  cursor: pointer;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  display: flex;
  flex-direction: column;
}
.card:hover { transform: scale(1.05); box-shadow: 0 4px 12px rgba(255,255,255,0.2); }
.card img { width: 100%; aspect-ratio: 16/9; object-fit: cover; }
.card-type {
  position: absolute; bottom: 8px; right: 8px;
  font-size: 12px; font-weight: bold; color:#fff;
  background:#ff0000; padding:2px 6px; border-radius:4px;
}
.actor {
  position: absolute; bottom: 8px; left: 8px;
  background: rgba(0,0,0,0.5);
  padding:2px 6px; border-radius:4px; font-size:12px;
}
.card-info { padding: 8px 10px; display: flex; flex-direction: column; gap: 6px; }
.card-info-top { display: flex; align-items: center; gap: 6px; overflow: hidden; }
.idcode { color: #ffcc00; font-weight: bold; font-size: 12px; white-space: nowrap; }
.title { font-size:14px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; flex-grow:1; }
.card-info-bottom { display: flex; justify-content: space-between; font-size:12px; color:#ccc; }
.star { color: gold; }
.date { display:flex; align-items:center; gap:4px; }
.date::before { content:"ğŸ“…"; }
.pagination {
  display: flex; justify-content:center; align-items:center; gap:6px;
  padding: 20px 0 40px;
}
.pagination button {
  padding: 6px 12px; background:#333; color:#fff;
  border:none; border-radius:4px; cursor:pointer;
}
.pagination button:hover:not(:disabled) { background:#555; }
.pagination button:disabled { opacity:.4; cursor:not-allowed; }
.pagination input { width:50px; padding:4px; background:#222; border:1px solid #555; color:#fff; text-align:center; border-radius:4px; }
</style>
</head>
<body>

<div id="header-placeholder"></div>
<div id="dramaSection">
  <div class="grid" id="dramaGrid"></div>
  <div class="pagination" id="pagination"></div>
</div>

<script>
// åŠ è½½å¤´éƒ¨å’Œåº•éƒ¨
fetch('header.html').then(r=>r.text()).then(html=>{
  document.getElementById('header-placeholder').innerHTML = html;
  const s=document.createElement('script'); s.src='header.js'; document.body.appendChild(s);
});
fetch('https://yunvgong.com/footer.html').then(r=>r.text()).then(html=>{
  const footer=document.createElement('div');
  footer.innerHTML = html;
  document.body.appendChild(footer);
});

let dramas = [];
let currentPage = 1, pageSize = 24;
let totalPages = 1;
const basePath = "https://yunvgong.com/JAV/category/main_page/";

// âœ… è®¡ç®—æ€»æ¡æ•°å’Œæ€»é¡µæ•°
async function calculateTotal(){
  let lastIndex = 1;
  while(true){
    const res = await fetch(`${basePath}page_${lastIndex}.json`);
    if(!res.ok) break;
    lastIndex++;
  }
  const lastRes = await fetch(`${basePath}page_${lastIndex-1}.json`);
  const lastData = await lastRes.json();
  const totalItems = (lastIndex-2)*1000 + lastData.length;
  totalPages = Math.ceil(totalItems/pageSize);
  console.log("æ€»æ¡æ•°:", totalItems, "æ€»é¡µæ•°:", totalPages);
}

// âœ… é¦–æ¬¡åŠ è½½ç¬¬ä¸€é¡µ
async function loadFirstPage(){
  await calculateTotal();
  const res = await fetch(`${basePath}page_1.json`);
  dramas = await res.json();
  renderPage(1);
  loadRemainingPages(); // åå°åŠ è½½
}

// âœ… åå°åŠ è½½å‰©ä½™æ•°æ®
async function loadRemainingPages(){
  for(let i=2;i<=totalPages;i++){
    const res = await fetch(`${basePath}page_${i}.json`);
    if(!res.ok) break;
    const data = await res.json();
    dramas.push(...data);
  }
  console.log("æ‰€æœ‰æ•°æ®å·²åŠ è½½:", dramas.length);
  renderPagination(); // æ›´æ–°åˆ†é¡µ
}

// âœ… æ¸²æŸ“é¡µé¢
function renderPage(p){
  currentPage = p;
  const box = document.getElementById('dramaGrid');
  box.innerHTML = '';
  const list = dramas.slice((p-1)*pageSize, p*pageSize);
  list.forEach(d=>{
    const a = Array.isArray(d.actress)?d.actress.join("ã€"):(d.actress||'æœªçŸ¥');
    box.innerHTML+=`
    <div class="card" onclick="location.href='${d.title_play_url}'">
      <div style="position:relative;">
        <img src="${d.cover_url}">
        <div class="actor">${a}</div>
        <div class="card-type">${d.type||'æœªçŸ¥'}</div>
      </div>
      <div class="card-info">
        <div class="card-info-top">
          <span class="idcode">${d.IDcode}</span>
          <span class="title">${d.title}</span>
        </div>
        <div class="card-info-bottom">
          <div class="star">â­â­â­â­â­</div>
          <div class="date">${d.publish_date}</div>
        </div>
      </div>
    </div>`;
  });
  renderPagination();
}

// âœ… åˆ†é¡µæ 
function renderPagination(){
  document.getElementById('pagination').innerHTML = `
    <button ${currentPage===1?'disabled':''} onclick="changePage(-1)">ä¸Šä¸€é¡µ</button>
    <span>ç¬¬ <input id="jump" type="number" min="1" max="${totalPages}" value="${currentPage}"> / ${totalPages} é¡µ</span>
    <button onclick="jumpPage()">è·³è½¬</button>
    <button ${currentPage===totalPages?'disabled':''} onclick="changePage(1)">ä¸‹ä¸€é¡µ</button>
  `;
}

function changePage(s){ renderPage(Math.max(1, Math.min(totalPages,currentPage+s))); }
function jumpPage(){ const p=parseInt(document.getElementById('jump').value); if(p>=1&&p<=totalPages) renderPage(p); }

loadFirstPage();
</script>
</body>
</html>
