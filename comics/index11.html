<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ¼«ç”»ç›®å½•</title>
<style>
body { margin:0; font-family:"å¾®è½¯é›…é»‘",sans-serif; background:#0d0d0d; color:#fff; padding-top:60px; }
.grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(240px,1fr)); gap:20px; padding:20px; }
.card { position:relative; background:#1a1a1a; border-radius:8px; overflow:hidden; cursor:pointer; transition:transform .2s ease,box-shadow .2s ease; display:flex; flex-direction:column; }
.card:hover { transform:scale(1.05); box-shadow:0 4px 12px rgba(255,255,255,.2); }
.card img { width:100%; aspect-ratio:16/9; object-fit:cover; }
.card-type { position:absolute; bottom:8px; right:8px; font-size:12px; font-weight:bold; color:#fff; background:#ff0000; padding:2px 6px; border-radius:4px; }
.actor { position:absolute; bottom:8px; left:8px; background:rgba(0,0,0,0.5); padding:2px 6px; border-radius:4px; font-size:12px; }
.card-info { padding:8px 10px; display:flex; flex-direction:column; gap:6px; }
.card-info-top { display:flex; align-items:center; gap:6px; overflow:hidden; }
.idcode { color:#ffcc00; font-weight:bold; font-size:12px; white-space:nowrap; }
.title { font-size:14px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; flex-grow:1; }
.card-info-bottom { display:flex; justify-content:space-between; font-size:12px; color:#ccc; }
.star { color:gold; }
.date { display:flex; align-items:center; gap:4px; }
.date::before { content:"ğŸ“…"; }
.pagination { display:flex; justify-content:center; align-items:center; gap:10px; padding:20px 0; }
.pagination button { padding:6px 12px; background:#333; color:#fff; border:none; border-radius:4px; cursor:pointer; }
.pagination button:hover:not(:disabled) { background:#555; }
.pagination button:disabled { opacity:.4; cursor:not-allowed; }
.pagination input { width:50px; padding:4px; background:#222; border:1px solid #555; color:#fff; text-align:center; border-radius:4px; }
/* å›ºå®š header */
#header-placeholder { position: fixed; top: 0; left: 0; width: 100%; z-index: 999; }
</style>
</head>
<body>

<div id="header-placeholder"></div>
<div class="grid" id="dramaGrid"></div>
<div class="pagination" id="pagination"></div>

<script>
let MAX_PAGE = 100; // æ ¹æ®ä½ çš„å®é™… page_X.js æ–‡ä»¶æ•°é‡è°ƒæ•´
let currentPage = 1;
let pageCache = {};

// è·å– URL å‚æ•°
function getPageFromURL(){
    const params = new URLSearchParams(window.location.search);
    let page = parseInt(params.get('pages')) || 1;
    if(page < 1) page = 1;
    if(page > MAX_PAGE) page = MAX_PAGE;
    return page;
}

// æ¸²æŸ“åˆ†é¡µæŒ‰é’®
function renderPagination(page){
    const pagination = document.getElementById('pagination');
    pagination.innerHTML = `
        <button ${page===1?'disabled':''} onclick="changePage(${page-1})">ä¸Šä¸€é¡µ</button>
        <span>ç¬¬ <input id="jumpPage" type="number" min="1" max="${MAX_PAGE}" value="${page}"> é¡µ / ${MAX_PAGE} é¡µ</span>
        <button onclick="jumpToPage()">è·³è½¬</button>
        <button ${page===MAX_PAGE?'disabled':''} onclick="changePage(${page+1})">ä¸‹ä¸€é¡µ</button>
    `;
}

// è·³è½¬é¡µå‡½æ•°
function jumpToPage(){
    const page = parseInt(document.getElementById('jumpPage').value);
    changePage(page);
}

// æ”¹å˜é¡µ
function changePage(page){
    if(page<1) page=1;
    if(page>MAX_PAGE) page=MAX_PAGE;
    window.history.replaceState({}, '', `?pages=${page}`);
    loadPage(page);
}

// æ¸²æŸ“æ¼«ç”»åˆ—è¡¨
function renderAll(data){
    const box = document.getElementById('dramaGrid');
    box.innerHTML = '';
    data.forEach(d=>{
        const a = Array.isArray(d.actress)?d.actress.join("ã€"):(d.actress||'æœªçŸ¥');
        box.innerHTML += `
        <div class="card" onclick="location.href='${d.url}'">
          <div style="position:relative;">
            <img src="${d.cover || 'https://via.placeholder.com/320x180?text=No+Cover'}">
            <div class="actor">${a}</div>
            <div class="card-type">${d.type||'æœªçŸ¥'}</div>
          </div>
          <div class="card-info">
            <div class="card-info-top">
              <span class="idcode">${d.IDcode}</span>
              <span class="title">${d.title}</span>
            </div>
          </div>
        </div>
        `;
    });
}

// åŠ è½½åˆ†é¡µ JS æ–‡ä»¶
function loadPage(page){
    if(pageCache[page]){
        renderAll(pageCache[page]);
        renderPagination(page);
        return;
    }

    const script = document.createElement('script');
    script.src = `all_page/page_${page}.js`; // ä¿®æ”¹ä¸ºä½ å­˜æ”¾çš„ JS è·¯å¾„
    script.onload = ()=>{
        if(typeof COMIC_DATA !== 'undefined'){
            pageCache[page] = COMIC_DATA;
            renderAll(COMIC_DATA);
            COMIC_DATA = undefined;
            renderPagination(page);
        } else {
            console.error(`page_${page}.js æœªå®šä¹‰ COMIC_DATA`);
        }
    };
    document.body.appendChild(script);
}

// é¡µé¢åˆå§‹åŒ–
currentPage = getPageFromURL();
loadPage(currentPage);
</script>

</body>
</html>
