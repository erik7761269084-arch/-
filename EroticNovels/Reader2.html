<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>小说阅读</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
:root{
    --bg:#111;
    --text:#e6e6e6;
    --title:#ffd479;
}

body{
    margin:0;
    background:var(--bg);
    color:var(--text);
    font-family:"Microsoft YaHei","PingFang SC",sans-serif;
}

/* 容器 */
#app{
    max-width:900px;
    margin:auto;
    padding:18px;
}

/* ===== 标题浮层 ===== */
#title{
    position:fixed;
    top:0;
    left:0;
    right:0;
    text-align:center;
    font-size:20px;
    color:var(--title);
    padding:14px 10px;
    background:rgba(0,0,0,.85);
    transform: translateY(-100%);
    transition:.25s;
    z-index:20;
}

/* ===== PC 正文 ===== */
#content{
    white-space:pre-wrap;
    font-size:18px;
    line-height:1.9;
}

/* ===== 手机分页正文 ===== */
#page{
    white-space:pre-wrap;
    font-size:18px;
    line-height:1.9;
    min-height:80vh;
    transition: transform .25s ease, opacity .25s ease;
}

/* 翻页动画 */
.page-next{ transform:translateX(40px); opacity:0; }
.page-prev{ transform:translateX(-40px); opacity:0; }

/* ===== 翻页点击层 ===== */
#tap{
    display:none;
    position:fixed;
    inset:0;
    z-index:5;
    display:flex;
}
.tap-zone{ flex:1; }

/* ===== 工具栏 ===== */
#toolbar{
    position:fixed;
    bottom:0;
    left:0;
    right:0;
    background:rgba(0,0,0,.85);
    border-top:1px solid #222;
    padding:6px 10px 10px;
    transform:translateY(100%);
    transition:.25s;
    z-index:20;
}

/* 按钮 */
#buttons{
    display:flex;
    justify-content:space-around;
}
#toolbar button{
    background:none;
    border:none;
    color:#fff;
    font-size:16px;
}

/* ===== 进度条 ===== */
#progress{
    width:100%;
    margin-bottom:6px;
}

/* ===== UI 显示状态 ===== */
.show-ui #title{ transform:translateY(0); }
.show-ui #toolbar{ transform:translateY(0); }

/* ===== 手机模式 ===== */
@media (max-width:899px){
    body{ overflow:hidden; }
    #content{ display:none; }
    #page{ display:block; }
    #tap{ display:flex; }
}

/* ===== PC 模式 ===== */
@media (min-width:900px){
    #page,#tap,#toolbar,#progress{ display:none; }
}
</style>
</head>

<body>

<div id="app">
    <div id="title">加载中...</div>
    <div id="content">正在加载...</div>
    <div id="page"></div>
</div>

<!-- 翻页点击区 -->
<div id="tap">
    <div class="tap-zone" onclick="onTap('prev')"></div>
    <div class="tap-zone" onclick="onTap('center')"></div>
    <div class="tap-zone" onclick="onTap('next')"></div>
</div>

<!-- 工具栏 -->
<div id="toolbar">
    <input id="progress" type="range" min="0" max="100" value="0" oninput="onSeek(this.value)">
    <div id="buttons">
        <button onclick="changeFont(-1)">A-</button>
        <button onclick="changeFont(1)">A+</button>
        <button onclick="toggleTheme()">日/夜</button>
    </div>
</div>

<script>
/* ===== 配置 ===== */
const txtUrl =
"https://raw.githubusercontent.com/erik7761269084-arch/EroticNovels/main/%E7%9F%AD%E7%AF%87/19%E5%B2%81%E7%9A%84%E5%A5%B3%E5%8F%8B%E5%96%9C%E6%AC%A2%E6%9A%B4%E9%9C%B2.txt";

/* ===== 标题 ===== */
const title = decodeURIComponent(txtUrl.split("/").pop().replace(".txt",""));
document.getElementById("title").innerText = title;

/* ===== 状态 ===== */
let fullText = "";
let pages = [];
let pageIndex = 0;
let fontSize = 18;
let night = true;
let uiVisible = false;

/* ===== 读取文本（GBK） ===== */
fetch(txtUrl)
  .then(r=>r.arrayBuffer())
  .then(buf=>{
      fullText = new TextDecoder("gbk").decode(buf);
      document.getElementById("content").innerText = fullText;
      paginate();
      renderPage();
  });

/* ===== 分页 ===== */
function paginate(){
    pages=[];
    const temp=document.createElement("div");
    Object.assign(temp.style,{
        position:"absolute",
        visibility:"hidden",
        fontSize:fontSize+"px",
        lineHeight:"1.9",
        whiteSpace:"pre-wrap",
        width:document.getElementById("page").offsetWidth+"px"
    });
    document.body.appendChild(temp);

    let start=0;
    while(start<fullText.length){
        let i=start+500;
        while(i<fullText.length){
            temp.innerText=fullText.slice(start,i);
            if(temp.offsetHeight>window.innerHeight*0.75) break;
            i+=50;
        }
        pages.push(fullText.slice(start,i));
        start=i;
    }
    document.body.removeChild(temp);
}

/* ===== 渲染 ===== */
function renderPage(effect){
    const page=document.getElementById("page");
    if(effect){
        page.classList.add(effect);
        setTimeout(()=>{
            page.innerText=pages[pageIndex]||"";
            page.classList.remove(effect);
        },150);
    }else{
        page.innerText=pages[pageIndex]||"";
    }
    updateProgress();
}

/* ===== 翻页 ===== */
function nextPage(){
    if(pageIndex<pages.length-1){
        pageIndex++;
        renderPage("page-next");
    }
}
function prevPage(){
    if(pageIndex>0){
        pageIndex--;
        renderPage("page-prev");
    }
}

/* ===== 点击处理 ===== */
function onTap(type){
    if(type==="center"){
        uiVisible=!uiVisible;
        document.body.classList.toggle("show-ui",uiVisible);
        return;
    }
    if(uiVisible) return;
    if(type==="next") nextPage();
    if(type==="prev") prevPage();
}

/* ===== 进度条 ===== */
function updateProgress(){
    document.getElementById("progress").value =
        Math.round((pageIndex/(pages.length-1))*100);
}
function onSeek(val){
    pageIndex=Math.round((val/100)*(pages.length-1));
    renderPage();
}

/* ===== 字号 ===== */
function changeFont(step){
    fontSize=Math.min(30,Math.max(14,fontSize+step));
    document.getElementById("content").style.fontSize=fontSize+"px";
    document.getElementById("page").style.fontSize=fontSize+"px";
    paginate();
    pageIndex=0;
    renderPage();
}

/* ===== 日夜 ===== */
function toggleTheme(){
    night=!night;
    document.documentElement.style.setProperty("--bg",night?"#111":"#f5f5f5");
    document.documentElement.style.setProperty("--text",night?"#e6e6e6":"#222");
    document.documentElement.style.setProperty("--title",night?"#ffd479":"#333");
}

/* ===== 自适应 ===== */
window.addEventListener("resize",()=>{
    if(innerWidth<900){
        paginate();
        renderPage();
    }
});
</script>

</body>
</html>
