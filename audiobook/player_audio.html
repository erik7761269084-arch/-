<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>有声小说播放器</title>
<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background-color: #111;
    color: #eee;
}
.container {
    display: flex;
    max-width: 1200px;
    margin: 20px auto;
    gap: 20px;
}
.left-panel {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
}
.cover-wrapper {
    position: relative;
    width: 250px;
    height: 250px;
    margin-bottom: 20px;
}
.cover {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background-size: cover;
    background-position: center;
    animation: spin 10s linear infinite;
    animation-play-state: paused;
    border: 5px solid #444;
}
@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}
.audio-controls {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
}
#audio { width: 100%; }
#bottom_title { text-align: center; margin-bottom: 10px; }
.right-panel {
    width: 320px;
    display: flex;
    flex-direction: column;
    gap: 15px;
}
.playlist {
    display: flex;
    flex-direction: column;
    gap: 5px;
}
.playlist button {
    width: 100%;
    padding: 6px 10px;
    background: #222;
    border: 1px solid #555;
    color: #ddd;
    border-radius: 6px;
    cursor: pointer;
    text-align: left;
}
.playlist button.active {
    background-color: #007bff;
    color: #fff;
}
.actress-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
}
.actress-card {
    position: relative;
    width: 90px;
    height: 120px;
    border-radius: 8px;
    overflow: hidden;
    background: #222;
    display: flex;
    align-items: center;
    justify-content: center;
}
.actress-card .name {
    text-align: center;
    font-size: 12px;
    color: #fff;
    padding: 3px;
}
</style>
</head>
<body>

<div class="container">
    <div class="left-panel">
        <div class="cover-wrapper">
            <div class="cover" id="cover"></div>
        </div>
        <div class="audio-controls">
            <h2 id="bottom_title">剧名 - 集数</h2>
            <audio id="audio" controls></audio>
        </div>
        <div class="playlist" id="playlist"></div>
    </div>
    <div class="right-panel">
        <h3>出演女优</h3>
        <div class="actress-grid" id="actressGrid"></div>
    </div>
</div>

<script>
// ===== 获取 URL 参数 =====
function getSeriesName() {
    const params = new URLSearchParams(window.location.search);
    return params.get('series') || '';
}

// ===== 加载 JSON 数据 =====
function loadSeriesData(seriesName) {
    if(!seriesName) { alert("❌ 系列未指定"); return; }
    const dataUrl = `https://yunvgong.com/audiobook/menu/${encodeURIComponent(seriesName)}_data.json`;
    fetch(dataUrl)
        .then(res => { if(!res.ok) throw new Error(`HTTP ${res.status}`); return res.json(); })
        .then(data => {
            window.seriesInfo = data.seriesInfo;
            window.episodes = data.episodes;
            initPlayer();
        })
        .catch(err => {
            console.error("剧集数据加载失败:", err);
            alert("剧集数据加载失败，请确认 URL 或 CORS 设置");
        });
}

// ===== 初始化播放器 =====
function initPlayer() {
    const audio = document.getElementById('audio');
    const playlist = document.getElementById('playlist');
    const bottomTitle = document.getElementById('bottom_title');
    const actressGrid = document.getElementById('actressGrid');
    const cover = document.getElementById('cover');

    bottomTitle.textContent = seriesInfo.title;
    if(seriesInfo.cover_url) cover.style.backgroundImage = `url('${seriesInfo.cover_url}')`;

    // 渲染女优
    actressGrid.innerHTML = '';
    if(Array.isArray(seriesInfo.actresses)){
        seriesInfo.actresses.forEach(a => {
            const card = document.createElement('div');
            card.className = "actress-card";
            card.innerHTML = `<div class="name">${a}</div>`;
            actressGrid.appendChild(card);
        });
    }

    // 渲染播放列表
    playlist.innerHTML = '';
    const keys = Object.keys(episodes);
    keys.forEach((name, idx) => {
        const btn = document.createElement('button');
        btn.textContent = name;
        btn.onclick = () => playEpisode(idx, btn);
        playlist.appendChild(btn);
    });

    function playEpisode(index, btn) {
        const name = keys[index];
        const url = episodes[name];
        if(!url) return;
        audio.src = url;
        audio.play();
        bottomTitle.textContent = `${seriesInfo.title} - ${name}`;
        [...playlist.children].forEach(b => b.classList.remove('active'));
        if(btn) btn.classList.add('active');
    }

    // 自动播放第一条
    if(keys.length > 0) playEpisode(0, playlist.firstChild);

    // 封面旋转控制
    audio.addEventListener('play', () => cover.style.animationPlayState = 'running');
    audio.addEventListener('pause', () => cover.style.animationPlayState = 'paused');
    audio.addEventListener('ended', () => cover.style.animationPlayState = 'paused');
}

// ===== 执行 =====
loadSeriesData(getSeriesName());
</script>

</body>
</html>
